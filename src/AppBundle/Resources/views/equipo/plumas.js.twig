
function cargarDatosTrPl(event) {

    var trpl = event.target;

    socket.on('trpl', function (data) {


        var data = data.split("\n");

        var dataset = Array();

        for (key in data) {

            var puntos = data[key].split(" ");

            for(p in puntos){
                puntos[p] = Number(puntos[p]);
            }

            dataset.push(puntos);
        }

        dataset.pop();

        data = dataset;

        for (clave in data) {

            var puntos = data[clave];

            var anemometro_serie = trpl.series[0], shift_anm = anemometro_serie.data.length > 1200;  // shift if the series is longer than 20
            var aparejo_serie = trpl.series[1], shift_apa = aparejo_serie.data.length > 1200;  // shift if the series is longer than 20
            var llave_serie = trpl.series[2], shift_llave = llave_serie.data.length > 1200; // shift if the series is longer than 20
            var boca_pozo_serie = trpl.series[3], shift_bp = boca_pozo_serie.data.length > 1200; // shift if the series is longer than 20

            //console.log(anemometro_serie.data.length);

            //hay que multiplicar por 1000 el unixtimestamp
            var tiempo = puntos[0] * 1000;
            var anemometro = puntos[1];
            var aparejo = puntos[2];
            var llave = puntos[3];
            var boca_pozo = puntos[4];

            anemometro_serie.addPoint([tiempo, anemometro], false, shift_anm);
            aparejo_serie.addPoint([tiempo, aparejo], false, shift_apa);
            llave_serie.addPoint([tiempo, llave], false, shift_llave);
            boca_pozo_serie.addPoint([tiempo, boca_pozo], false, shift_bp);
        }


        trpl.redraw();

    });

}

function cargarDatosHstpl(event){

    var hstpl = event.target;

    var anemometro_serie = hstpl.series[0];
    var aparejo_serie = hstpl.series[1];
    var llave_serie = hstpl.series[2];
    var boca_pozo_serie = hstpl.series[3];


    socket.emit('hstpl_demanda');

    socket.on('hstpl', function (data) {


        hstpl.showLoading('Cargando datos del servidor...');

        var data = JSON.parse(data);

        var anemometro_data = new Array();
        var aparejo_data = new Array();
        var llave_data = new Array();
        var boca_pozo_data = new Array();

        data.forEach(function(item, index, ar){

            anemometro_data.push([Number(item.t)*1000,Number(item.anem)]);
            aparejo_data.push([Number(item.t)*1000,Number(item.hta)]);
            llave_data.push([Number(item.t)*1000,Number(item.llave)]);
            boca_pozo_data.push([Number(item.t)*1000,Number(item.bpozo)]);

        });

        anemometro_serie.setData(anemometro_data,false,false,true);
        aparejo_serie.setData(aparejo_data,false,false,true);
        llave_serie.setData(llave_data,false,false,true);
        boca_pozo_serie.setData(boca_pozo_data,false,false,true);

        hstpl.redraw();
        hstpl.hideLoading();
        

    });
}

$(document).ready(function(){

    {#$('#hstpl').highcharts({#}
        {#chart: {#}
            {#zoomType: 'xy',#}
            {#animation: false,#}
            {#events: {#}
                {#load: cargarDatosHstpl#}
            {#}#}
        {#},#}
        {#plotOptions: {#}
            {#series: {#}
                {#turboThreshold: 10000000,#}
                {#lineWidth: 1,#}
                {#states: {#}
                    {#hover:{#}
                        {#lineWidth: 1,#}
                    {#},#}
                {#},#}
                {#marker: {#}
                    {#enabled: false#}
                {#}#}
            {#}#}
        {#},#}
        {#title: {#}
            {#text: ''#}
        {#},#}
        {#subtitle: {#}
            {#text: ''#}
        {#},#}
        {#credits: {#}
            {#enabled: false#}
        {#},#}
        {#xAxis: [{#}
            {#crosshair: true,#}
            {#labels: {#}
                {#rotation: -45#}
            {#},#}
{#//                    tickPixelInterval: 150,#}
{#//                    maxZoom: 20 * 1000,#}
            {#type: 'datetime',#}
            {#dateTimeLabelFormats: {#}
                {#millisecond: '%H:%M:%S',#}
            {#}#}

        {#}],#}
        {#yAxis: [#}
            {#{ // Secondary yAxis#}
                {#gridLineWidth: 0,#}
                {#title: {#}
                    {#text: 'Anemómetro (km/h)',#}
                    {#style: {#}
                        {#color: '#D8D8D8'#}
                    {#}#}
                {#},#}
                {#labels: {#}
                    {#format: '{value}',#}
                    {#style: {#}
                        {#color: '#D8D8D8'#}
                    {#}#}
                {#}#}

            {#}, { // Primary yAxis#}
                {#labels: {#}
                    {#format: '{value}',#}
                    {#style: {#}
                        {#color: Highcharts.getOptions().colors[1]#}
                    {#}#}
                {#},#}
                {#title: {#}
                    {#text: 'Aparejo (klb)',#}
                    {#style: {#}
                        {#color: Highcharts.getOptions().colors[1]#}
                    {#}#}
                {#}#}

            {#}, { // Tertiary yAxis#}
                {#gridLineWidth: 0,#}
                {#title: {#}
                    {#text: 'Presión (psi)',#}
                    {#style: {#}
                        {#color: Highcharts.getOptions().colors[0]#}
                    {#}#}
                {#},#}
                {#labels: {#}
                    {#format: '{value}',#}
                    {#style: {#}
                        {#color: Highcharts.getOptions().colors[0]#}
                    {#}#}
                {#},#}
                {#opposite: true#}
            {#}#}
        {#],#}
        {#tooltip: {#}
            {#shared: true#}
        {#},#}
        {#/*legend: {#}
         {#layout: 'vertical',#}
         {#align: 'left',#}
         {#x: 80,#}
         {#verticalAlign: 'top',#}
         {#y: 0,#}
         {#floating: true,#}
         {#backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF'#}
         {#},*/#}
        {#series: [#}
            {#{#}
                {#name: 'Anemómetro',#}
                {#type: 'spline',#}
                {#dashStyle: 'Dot',#}
                {#color: '#D8D8D8',#}
                {#lineWidth: 1,#}
                {#yAxis: 0,#}
                {#//data: [49.9, 71.5, 106.4, 129.2, 144.0, 176.0, 135.6, 148.5, 216.4, 194.1, 95.6, 54.4],#}
                {#tooltip: {#}
                    {#valueSuffix: ' km/h'#}
                {#}#}
            {#}, {#}
                {#name: 'Aparejo',#}
                {#type: 'spline',#}
                {#color: Highcharts.getOptions().colors[1],#}
                {#lineWidth: 1,#}
                {#yAxis: 1,#}
                {#//data: [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 50, 13.9, 9.6],#}
                {#tooltip: {#}
                    {#valueSuffix: ' klb'#}
                {#}#}
            {#}, {#}

                {#name: 'Llave',#}
                {#type: 'spline',#}
                {#yAxis: 2,#}
                {#//data: [1416, 1216, 915.9, 1015.5, 812.3, 1309.5, 1109.6, 1910.2, 1013.1, 1616.9, 1218.2, 1016.7],#}
                {#marker: {#}
                    {#enabled: false#}
                {#},#}
                {#color: Highcharts.getOptions().colors[2],#}
                {#lineWidth: 1,#}
                {#dashStyle: 'spline',#}
                {#tooltip: {#}
                    {#valueSuffix: ' psi'#}
                {#}#}

            {#}, {#}
                {#name: 'Boca Pozo',#}
                {#type: 'spline',#}
                {#yAxis: 2,#}
                {#//data: [1400.0, 1000.9, 1900.5, 1750.5, 1800.2, 900.5, 784.2, 1260.5, 1736.3, 1000.3, 1350.9, 920.6],#}
                {#tooltip: {#}
                    {#valueSuffix: ' psi'#}
                {#}#}
            {#}#}
        {#]#}
    {#});#}


    $('#hstpl').highcharts('StockChart', {

        chart: {
            events: {
                load: cargarDatosHstpl
            }
        },

        rangeSelector: {
            selected: 2,
            allButtonsEnabled: true,
            buttons: [
                {
                    type: 'second',
                    count: 30,
                    text: 'sec'
                },{
                    type: 'minute',
                    count: 10,
                    text: 'min'
                },{
                    type: 'day',
                    count: 1,
                    text: 'día'
                },{
                    type: 'day',
                    count: 5,
                    text: '5d'
                }
            ]
        },
        credits: {
            enabled: false
        },
        series: [
            {
                name: 'Anemómetro',
                type: 'spline',
                dashStyle: 'Dot',
                color: '#D8D8D8',
                lineWidth: 1,
                tooltip: {
                    valueSuffix: ' km/h',
                    valueDecimals: 2
                }
            }, {
                name: 'Aparejo',
                type: 'spline',
                color: Highcharts.getOptions().colors[1],
                lineWidth: 1,
                tooltip: {
                    valueSuffix: ' klb',
                    valueDecimals: 2
                }
            }, {

                name: 'Llave',
                type: 'spline',
                marker: {
                    enabled: false
                },
                color: Highcharts.getOptions().colors[2],
                lineWidth: 1,
                dashStyle: 'spline',
                tooltip: {
                    valueSuffix: ' psi',
                    valueDecimals: 2
                }

            }, {
                name: 'Boca Pozo',
                type: 'spline',
                tooltip: {
                    valueSuffix: ' psi',
                    valueDecimals: 2
                }
            }
        ]
    });

    $('#trpl').highcharts({
        chart: {
            zoomType: 'xy',
            //renderTo: 'trpl',
            animation: false,
            events: {
                load: cargarDatosTrPl
            }
        },
        plotOptions: {
            series: {
                lineWidth: 1,
                states: {
                    hover:{
                        lineWidth: 1,
                    },
                },
                marker: {
                    enabled: false
                }
            }
        },
        title: {
            text: ''
        },
        subtitle: {
            text: ''
        },
        credits: {
            enabled: false
        },
        xAxis: [{
            crosshair: true,
            labels: {
                rotation: -45
            },
//                    tickPixelInterval: 150,
//                    maxZoom: 20 * 1000,
            type: 'datetime',
            dateTimeLabelFormats: {
                millisecond: '%H:%M:%S',
            }

        }],
        yAxis: [
            { // Secondary yAxis
                gridLineWidth: 0,
                title: {
                    text: 'Anemómetro (km/h)',
                    style: {
                        color: '#D8D8D8'
                    }
                },
                labels: {
                    format: '{value}',
                    style: {
                        color: '#D8D8D8'
                    }
                },
                min:0,
                max: 120

            }, { // Primary yAxis
                labels: {
                    format: '{value}',
                    style: {
                        color: Highcharts.getOptions().colors[1]
                    }
                },
                title: {
                    text: 'Aparejo (klb)',
                    style: {
                        color: Highcharts.getOptions().colors[1]
                    }
                },
                min:0,
                max: 180,
                tickInterval: 30,

            }, { // Tertiary yAxis
                gridLineWidth: 0,
                title: {
                    text: 'Presión (psi)',
                    style: {
                        color: Highcharts.getOptions().colors[0]
                    }
                },
                labels: {
                    format: '{value}',
                    style: {
                        color: Highcharts.getOptions().colors[0]
                    }
                },
                opposite: true,
                min:0,
                max: 3000
            }
        ],
        tooltip: {
            shared: true
        },
        series: [
            {
                name: 'Anemómetro',
                type: 'line',
                yAxis: 0,
                dashStyle: 'Dot',
                color: '#D8D8D8',
                lineWidth: 2,
                tooltip: {
                    valueSuffix: ' km/h'
                }
            }, {
                name: 'Aparejo',
                type: 'line',
                color: Highcharts.getOptions().colors[1],
                yAxis: 1,
                tooltip: {
                    valueSuffix: ' klb'
                }
            }, {

                name: 'Llave',
                type: 'line',
                color: Highcharts.getOptions().colors[2],
                yAxis: 2,
                tooltip: {
                    valueSuffix: ' psi'
                }

            }, {
                name: 'Boca Pozo',
                type: 'line',
                yAxis: 2,
                tooltip: {
                    valueSuffix: ' psi'
                }
            }
        ]
    });
});