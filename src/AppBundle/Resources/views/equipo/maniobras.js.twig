var trman;

function cargarDatosTrMan(){

    socket.on('trman', function (data) {

        try{

            if(data == undefined || data == '') return false;

            var data = JSON.parse(data);

            data.forEach(function(item, index, ar){

                //console.log(item);

                var vb_serie            = trman.series[0], shift_vb         = vb_serie.data.length > 1200;
                var prb_pozo_serie      = trman.series[1], shift_prb_pozo   = prb_pozo_serie.data.length > 1200;
                var viento_serie        = trman.series[2], shift_viento     = viento_serie.data.length > 1200;
                var ajuste_def_serie    = trman.series[3], shift_ajuste_def = ajuste_def_serie.data.length > 1200;
                var ajuste_exc_serie    = trman.series[4], shift_ajuste_exc = ajuste_exc_serie.data.length > 1200;
                var tension_serie       = trman.series[5], shift_tension    = tension_serie.data.length > 1200;
                var prb_elev_serie      = trman.series[6], shift_prb_elev   = prb_elev_serie.data.length > 1200;

                //console.log(anemometro_serie.data.length);

                //hay que multiplicar por 1000 el unixtimestamp
                var tiempo     = item.t;
                var vb         = item.mtv;
                var prb_pozo   = item.pbp;
                var viento     = item.vto;
                var ajuste_def = item.adef;
                var ajuste_exc = item.aexe;
                var tension    = item.tmay;
                //var prb_elev   = Number(item.);


                vb_serie.addPoint([tiempo,vb],false,shift_vb);
                prb_pozo_serie.addPoint([tiempo,prb_pozo],false,shift_prb_pozo);
                viento_serie.addPoint([tiempo,viento],false,shift_viento);
                ajuste_def_serie.addPoint([tiempo,ajuste_def],false,shift_ajuste_def);
                ajuste_exc_serie.addPoint([tiempo,ajuste_exc],false,shift_ajuste_exc);
                tension_serie.addPoint([tiempo,tension],false,shift_tension);
                //prb_elev_serie.addPoint([tiempo,prb_elev],false,shift_prb_elev);

            });

            trman.redraw();

    }catch(e){
        console.log(e.name);
    }

    });
}


$(document).ready(function(){

    trman = new Highcharts.Chart({
        chart: {
            zoomType: 'xy',
            renderTo: 'trman',
            animation: false,
            events: {
                load: cargarDatosTrMan
            }
        },
        plotOptions: {
            series: {
                lineWidth: 2,
                states: {
                    hover:{
                        lineWidth: 3,
                    },
                },
                marker: {
                    enabled: false
                },
                enableMouseTracking: false
            }
        },
        title: {
            text: ''
        },
        subtitle: {
            text: ''
        },
        credits: {
            enabled: false
        },
        xAxis: [{
            crosshair: true,
            labels: {
                rotation: -45
            },
//                    tickPixelInterval: 150,
//                    maxZoom: 20 * 1000,
            type: 'datetime',
            dateTimeLabelFormats: {
                millisecond: '%H:%M:%S',
            }

        }],
        yAxis: [
            { // Primary yAxis
                gridLineWidth: 0,
                title: {
                    text: 'Valores',
                    enabled: false
                },
                labels: {
                    format: '{value}',
                    enabled: false
                },
                min: 0,
                max: 60
            }
        ],
        tooltip: {
            shared: true
        },

        series: [
            {
                name: 'Mov Tbg o Vb',
                type: 'line',
                yAxis: 0,
                tooltip: {
                    valueSuffix: ' '
                }
            }, {
                name: 'Presion en B Pozo',
                type: 'line',
                yAxis: 0,
            }, {

                name: 'Viento mayor a 45 Km/h',
                type: 'line',
                yAxis: 0,
            }, {
                name: 'Ajuste deficiente',
                type: 'line',
                yAxis: 0,
            }, {
                name: 'Ajuste exesivo',
                type: 'line',
                yAxis: 0,
            }, {
                name: 'Tension mayor a 120 Klb',
                type: 'line',
                yAxis: 0,
            }, {
                name: 'Presion en B Pozo elevada',
                type: 'line',
                yAxis: 0,
            }
        ]
    });

});
